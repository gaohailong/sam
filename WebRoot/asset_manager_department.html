
<div class="row-fluid">
	<div class="span12">
		<!-- BEGIN PAGE TITLE & BREADCRUMB-->
		<h3 class="page-title">系统管理</h3>
		<ul class="breadcrumb">

			<li><i class="icon-home"></i> <a href="index.html">首页</a> <span
				class="icon-angle-right"></span></li>

			<li><a href="#">系统管理</a> <span class="icon-angle-right"></span>

			</li>

			<li><a href="#">部门管理</a></li>

		</ul>
		<!-- END PAGE TITLE & BREADCRUMB-->
	</div>

</div>

<!-- END PAGE HEADER-->

<!-- BEGIN PAGE CONTENT-->
<div class="row-fluid">
	<div class="span12">

		<!-- BEGIN SAMPLE TABLE PORTLET-->

		<div class="portlet box red ">
			<div class="portlet-title">
				<div class="caption">
					<i class="icon-cogs"></i>查询
				</div>
				<div class="actions">
					<!--<a href="#" class="btn yellow "><i class="icon-pencil"></i> Edit</a>-->
					<a href="#responsive" data-toggle="modal" class="btn green"
						id="addbtn"><i class="icon-search"></i>新增</a>
				</div>
			</div>

			<div class="portlet-body">

				<table class="table table-hover">

					<thead id="assetThead">

						<th>部门名称</th>

						<th>增加子菜单</th>

						<th>修改</th>

						<th>删除</th>

					</thead>


					<tbody id="assetTbody">
						<a href="#responsive2" data-toggle="modal" class="hide"
							id="addnbsp">&nbsp;</a>
						<a href="#updateresponsive" data-toggle="modal" class="hide"
							id="updatenbsp">&nbsp;</a>

					</tbody>

				</table>

			</div>

			<div id="responsive" class="modal hide fade" tabindex="-1"
				data-width="580" data-height="150">

				<div class="modal-header">

					<span class="hidden-480">新增部门表</span>
				</div>
				<div class="modal-body">

					<div class="portlet-body form">

						<div class="tabbable portlet-tabs">

							<div class="tab-content">

								<div class="tab-pane active" id="portlet_tab1">

									<!-- BEGIN FORM-->

									<form class="form-horizontal" id="type1form">

										<div class="control-group">
											<div class="control-group"></div>
											<div class="control-group"></div>
											<div class="control-group"></div>

											<label class="control-label">部门名称</label>

											<div class="controls">

												<input type="text" id="item_as_type" class="m-wrap medium"
													name="adname" />

											</div>

										</div>

										<input type="hidden" name="adlevel" value="0" /> <input
											id="accept-tbody-reset" type="reset" class="hide" />

									</form>

									<!-- END FORM-->

								</div>


							</div>

						</div>

					</div>
				</div>

				<div class="modal-footer">

					<button id="accept-tbody-close" type="button" data-dismiss="modal"
						class="btn">关闭</button>

					<button type="button" class="btn blue"
						onclick="javascript:addType()">保存</button>



				</div>

			</div>

			<div id="responsive2" class="modal hide fade" tabindex="-1"
				data-width="580" data-height="150">

				<div class="modal-header">

					<span class="hidden-480">新增二级部门</span>
				</div>
				<div class="modal-body">

					<div class="portlet-body form">

						<div class="tabbable portlet-tabs">

							<div class="tab-content">

								<div class="tab-pane active" id="portlet_tab1">

									<!-- BEGIN FORM-->

									<form class="form-horizontal" id="type2form">

										<div class="control-group">
											<div class="control-group"></div>
											<div class="control-group"></div>
											<div class="control-group"></div>

											<label class="control-label">二级部门名称</label>

											<div class="controls">

												<input type="text" id="item_as_type" class="m-wrap medium"
													name="adname" />

											</div>

										</div>
										<input id="accept-tbody-reset" type="reset" class="hide" />

									</form>

									<!-- END FORM-->

								</div>


							</div>

						</div>

					</div>
				</div>

				<div class="modal-footer">

					<button id="accept-tbody-close" type="button" data-dismiss="modal"
						class="btn">关闭</button>

					<button type="button" class="btn blue"
						onclick="javascript:addTypeSecond()">保存</button>



				</div>

			</div>

			<div id="updateresponsive" class="modal hide fade" tabindex="-1"
				data-width="580" data-height="150">

				<div class="modal-header">

					<span class="hidden-480">部门修改表</span>
				</div>
				<div class="modal-body">

					<div class="portlet-body form">

						<div class="tabbable portlet-tabs">

							<div class="tab-content">

								<div class="tab-pane active" id="portlet_tab1">

									<!-- BEGIN FORM-->

									<form class="form-horizontal" id="typeupdateform">

										<div class="control-group">
											<div class="control-group"></div>
											<div class="control-group"></div>
											<div class="control-group"></div>

											<label class="control-label">类型名称</label>

											<div class="controls">

												<input type="text" id="item_as_type_update"
													class="m-wrap medium" name="adname" />

											</div>

										</div>

										<div class="control-group hide">

											<label class="control-label">类型等级</label>

											<div class="controls">

												<input type="hidden" id="item_as_name_update"
													class="m-wrap medium" name="adlevel" />

											</div>

										</div>

										<input id="accept-tbody-reset" type="reset" class="hide" />

									</form>

									<!-- END FORM-->

								</div>


							</div>

						</div>

					</div>
				</div>

				<div class="modal-footer">

					<button id="accept-tbody-close" type="button" data-dismiss="modal"
						class="btn">关闭</button>

					<button type="button" class="btn blue"
						onclick="javascript:updateType()">保存</button>



				</div>

			</div>

		</div>
		<!-- END SAMPLE TABLE PORTLET-->
	</div>


</div>

<div class="row-fluid">

	<div class="span12">

		<!-- BEGIN SAMPLE TABLE PORTLET-->
		<center>
			<a href="javascript:initAllAssetType(1);" data-toggle="modal"
				class="btn red ">首页</a> | <a id="perPage" href=""
				data-toggle="modal" class="btn red ">上一页</a> | <a id="nextPage"
				href="" data-toggle="modal" class="btn red ">下一页</a> | <a
				id="las tPage" href="" data-toggle="modal" class="btn red ">尾页</a> |
			第<span id="currentPage"></span>页 | 共<span id="totalRecord"></span>条数据
		</center>

		<!-- END SAMPLE TABLE PORTLET-->
	</div>
</div>


<script>
	jQuery(document).ready(function() {

		initDepartment();

		initAllAssetType(1, 0);
	});
	function initDepartment() {

		$.ajax({
					type : "GET",
					url : "/sam/department/findDepartmentsFirst",
					dataType : "JSON",
					success : function(data) {
						$(data)
								.each(
										function(index, value) {
											$("#item_department")
													.append(
															"<li><a href='#'>"
																	+ value.adname
																	+ "<span class='arrow'></span></a><ul id='second_department_" + value.adid + "' class='sub-menu'></ul></li>");
											initSecondDepartment(value.adid);
										});
					},
					errot : function(data) {
						alert(data.status);
					}

				});
	}
	//遍历二级部门的方法
	function initSecondDepartment(adlevel) {
		$.ajax({
			type : "post",
			url : "/sam/department/findDepartmentsSecond",
			data : "adlevel=" + adlevel,
			dataType : "JSON",
			success : function(data) {
				$(data).each(
						function(index, val) {
							$("#second_department_" + adlevel).append(
									"<li><a href='#'>" + val.adname
											+ "</a></li>");
						});
			},
			error : function(data) {
				alert(data.status);
			}
		});
	}

	function addType() {
		$.ajax({
			type : "post",
			url : "/sam/department/addDepartment",
			data : $('#type1form').serialize(),
			dataType : "JSON",
			success : function(data) {
				if (data > 0)
					alert("添加成功");
			},
			error : function(data) {
				alert("添加错误");
			}
		});
	}

	function addTypeSecond() {
		$.ajax({
			type : "post",
			url : "/sam/department/addDepartmentSecond",
			data : $('#type2form').serialize(),
			dataType : "JSON",
			success : function(data) {
				if (data > 0)
					alert("添加成功");
			},
			error : function() {
				alert("添加错误");
			}
		});
	}

	//初始化全部设备的分页信息
	function initAllAssetType(page, adlevel) {
		$.ajax({
					type : "GET",
					url : "/sam/department/findDepartment",
					data : "page=" + page + "&adlevel=" + adlevel,
					dataType : "JSON",
					success : function(data) {

						//总页数
						var totalPage = data.totalPage;

						//当前页码
						var currentPage = data.currentPage;
						$("#currentPage").html(currentPage);

						var perPagenum;
						perPagenum = page - 1;
						if (perPagenum < 1) {
							perPagenum = 1;
						}
						$("#perPage").attr(
								"href",
								"javascript:initAllAssetType(" + perPagenum
										+ ");");
						var lastpagenum;
						nextPage = page + 1;
						if (nextPage > totalPage) {
							nextPage = totalPage;
						}
						$("#nextPage").attr(
								"href",
								"javascript:initAllAssetType(" + nextPage
										+ ");");
						$("#lastPage").attr(
								"href",
								"javascript:initAllAssetType(" + totalPage
										+ ");");

						//总条目数
						var totalRecord = data.totalRecord;
						$("#totalRecord").html(totalRecord);

						var assetTypeList = data.dataList;
						$("#assetTbody").html("");
						for (var i = 0; i < assetTypeList.length; i++) {
							$("#assetTbody")
									.append(
											"<tr>"
													+ "<td><a href='javascript:initSecondAssetType(1,"
													+ assetTypeList[i].adid
													+ ")'>"
													+ assetTypeList[i].adname
													+ "</a></td>"
													+ "<td id='addTypeTd'><a href='javascript:getTypeFirst("
													+ assetTypeList[i].adid
													+ ");' data-toggle='modal'>增加</a></td>"
													+ "<td id='updateTypeTd'><a href=\"javascript:getHouse("
													+ assetTypeList[i].adid
													+ ","
													+ assetTypeList[i].adlevel
													+ ",'"
													+ assetTypeList[i].adname
													+ "');\" data-toggle='modal'>修改</a></td>"
													+ "<td><a class='delete' href='javascript:deleteType("
													+ assetTypeList[i].adid
													+ ");'>删除</a></td>"
													+ "</tr>");
						}
					},
					error : function(data) {
						alert("出错了" + data.status);
					}
				});
	}

	//显示二级类型菜单
	function initSecondAssetType(page, adid) {
		$
				.ajax({
					type : "post",
					url : "/sam/department/findDepartmentSecond",
					data : "page=" + page + "&adid=" + adid,
					dataType : "JSON",
					success : function(data) {

						//总页数
						var totalPage = data.totalPage;

						//当前页码
						var currentPage = data.currentPage;
						$("#currentPage").html(currentPage);

						var perPagenum;
						perPagenum = page - 1;
						if (perPagenum < 1) {
							perPagenum = 1;
						}
						$("#perPage").attr(
								"href",
								"javascript:initSecondAssetType(" + perPagenum
										+ ");");
						var lastpagenum;
						nextPage = page + 1;
						if (nextPage > totalPage) {
							nextPage = totalPage;
						}
						$("#nextPage").attr(
								"href",
								"javascript:initSecondAssetType(" + nextPage
										+ ");");
						$("#lastPage").attr(
								"href",
								"javascript:initSecondAssetType(" + totalPage
										+ ");");

						//总条目数
						var totalRecord = data.totalRecord;
						$("#totalRecord").html(totalRecord);

						var assetTypeList = data.dataList;
						$("#assetTbody").html("");
						$("#assetThead").html("");
						$("#addbtn").attr("class", "hide");
						$("#assetThead").append(
								"<th>部门名称</th><th>修改</th><th>删除</th>");

						for (var i = 0; i < assetTypeList.length; i++) {
							$("#assetTbody")
									.append(
											"<tr>"
													+ "<td><a href='#'>"
													+ assetTypeList[i].adname
													+ "</a></td>"
													+ "<td id='updateTypeTd'><a href=\"javascript:getHouse("
													+ assetTypeList[i].adid
													+ ","
													+ assetTypeList[i].adlevel
													+ ",'"
													+ assetTypeList[i].adname
													+ "');\" data-toggle='modal'>修改</a></td>"
													+ "<td><a class='delete' href='javascript:deleteType("
													+ assetTypeList[i].adid
													+ ");'>删除</a></td>"
													+ "</tr>");
						}
					},
					error : function(data) {
						alert("出错了" + data.status);
					}
				});
	}

	//获取修改页面数据的方法
	function getHouse(adid, adlevel, adname) {
		document.getElementById("item_as_type_update").value = adname;
		document.getElementById("item_as_name_update").value = adlevel;

		$("#typeupdateform").append(
				"<input type='hidden' name='adid' value='"+adid+"'/>");
		$("#typeupdateform").append(
				"<input type='hidden' name='adlevel' value='"+adlevel+"'/>");
		$("#updatenbsp").click();

	}

	//获取一级菜单的编号
	function getTypeFirst(adid) {
		$("#type2form").append(
				"<input type='hidden' name='adlevel' value='"+adid+"'/>");
		$("#addnbsp").click();
	}
	//删除用户
	function deleteType(adid) {
		$.ajax({
			type : "post",
			url : "/sam/department/deleteDepartment/" + adid,
			dataType : "JSON",
			success : function(data) {
				if (data > 0)
					alert("删除成功");
				initAllAssetType(1,adlevel);
			},
			error : function(data) {
				alert("删除失败" + data.status);
			}
		});
	}

	//修改的方法
	function updateType() {
		$.ajax({
			type : "post",
			url : "/sam/department/updateDepartment",
			data : $("#typeupdateform").serialize(),
			dataType : "JSON",
			success : function(data) {
				if (data > 0)
					alert("修改成功");
				initAllAssetType(1, adlevel);
			},
			error : function(data) {
				alert("修改失败");
			}
		});
	}
</script>
